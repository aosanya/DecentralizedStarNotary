<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Star Notary</title>
        <!-- <link rel="stylesheet" type="text/css" href="style.css"> -->

        <script src="https://cdn.jsdelivr.net/gh/ethereum/web3.js/dist/web3.min.js"></script>
    </head>

    <body>
        <div class="container">
            <h1>Star Notary</h1>

            <div class="row">
                <label class="bold">Star Name:</label>
                <label id="star-name"></label>
            </div>

            <div class="row">
                <label class="bold">Star Owner:</label>
                <label id="star-owner"></label>
            </div>
            <button id="createContract-button" onclick="createContractClicked()">Create Contract</button>
            <button id="claim-button" onclick="claimButtonClicked()">Claim Star</button>
            <label id="msg"></label>
        </div>

        <script>

            if(typeof web3 != 'undefined') {
                web3 = new Web3(web3.currentProvider) // what Metamask injected
            } else {
                // Instantiate and set Ganache as your provider
                web3 = new Web3(new Web3.providers.HttpProvider("http://localhost:9545"));
            }
            // The default (top) wallet account from a list of test accounts
            web3.eth.defaultAccount = web3.eth.accounts[0];

            // The interface definition for your smart contract (the ABI)
            let abi = [
                    {
                    "constant": true,
                    "inputs": [
                        {
                        "name": "interfaceId",
                        "type": "bytes4"
                        }
                    ],
                    "name": "supportsInterface",
                    "outputs": [
                        {
                        "name": "",
                        "type": "bool"
                        }
                    ],
                    "payable": false,
                    "stateMutability": "view",
                    "type": "function"
                    },
                    {
                    "constant": true,
                    "inputs": [
                        {
                        "name": "",
                        "type": "uint256"
                        }
                    ],
                    "name": "starsForSale",
                    "outputs": [
                        {
                        "name": "",
                        "type": "uint256"
                        }
                    ],
                    "payable": false,
                    "stateMutability": "view",
                    "type": "function"
                    },
                    {
                    "constant": true,
                    "inputs": [
                        {
                        "name": "tokenId",
                        "type": "uint256"
                        }
                    ],
                    "name": "getApproved",
                    "outputs": [
                        {
                        "name": "",
                        "type": "address"
                        }
                    ],
                    "payable": false,
                    "stateMutability": "view",
                    "type": "function"
                    },
                    {
                    "constant": false,
                    "inputs": [
                        {
                        "name": "to",
                        "type": "address"
                        },
                        {
                        "name": "tokenId",
                        "type": "uint256"
                        }
                    ],
                    "name": "approve",
                    "outputs": [],
                    "payable": false,
                    "stateMutability": "nonpayable",
                    "type": "function"
                    },
                    {
                    "constant": true,
                    "inputs": [
                        {
                        "name": "",
                        "type": "uint256"
                        }
                    ],
                    "name": "tokenIdToStarInfo",
                    "outputs": [
                        {
                        "name": "name",
                        "type": "string"
                        },
                        {
                        "name": "starStory",
                        "type": "string"
                        },
                        {
                        "name": "ra",
                        "type": "string"
                        },
                        {
                        "name": "dec",
                        "type": "string"
                        },
                        {
                        "name": "mag",
                        "type": "string"
                        }
                    ],
                    "payable": false,
                    "stateMutability": "view",
                    "type": "function"
                    },
                    {
                    "constant": false,
                    "inputs": [
                        {
                        "name": "from",
                        "type": "address"
                        },
                        {
                        "name": "to",
                        "type": "address"
                        },
                        {
                        "name": "tokenId",
                        "type": "uint256"
                        }
                    ],
                    "name": "transferFrom",
                    "outputs": [],
                    "payable": false,
                    "stateMutability": "nonpayable",
                    "type": "function"
                    },
                    {
                    "constant": false,
                    "inputs": [
                        {
                        "name": "from",
                        "type": "address"
                        },
                        {
                        "name": "to",
                        "type": "address"
                        },
                        {
                        "name": "tokenId",
                        "type": "uint256"
                        }
                    ],
                    "name": "safeTransferFrom",
                    "outputs": [],
                    "payable": false,
                    "stateMutability": "nonpayable",
                    "type": "function"
                    },
                    {
                    "constant": true,
                    "inputs": [
                        {
                        "name": "",
                        "type": "bytes32"
                        }
                    ],
                    "name": "tokenExists",
                    "outputs": [
                        {
                        "name": "",
                        "type": "bool"
                        }
                    ],
                    "payable": false,
                    "stateMutability": "view",
                    "type": "function"
                    },
                    {
                    "constant": true,
                    "inputs": [
                        {
                        "name": "tokenId",
                        "type": "uint256"
                        }
                    ],
                    "name": "ownerOf",
                    "outputs": [
                        {
                        "name": "",
                        "type": "address"
                        }
                    ],
                    "payable": false,
                    "stateMutability": "view",
                    "type": "function"
                    },
                    {
                    "constant": true,
                    "inputs": [
                        {
                        "name": "owner",
                        "type": "address"
                        }
                    ],
                    "name": "balanceOf",
                    "outputs": [
                        {
                        "name": "",
                        "type": "uint256"
                        }
                    ],
                    "payable": false,
                    "stateMutability": "view",
                    "type": "function"
                    },
                    {
                    "constant": false,
                    "inputs": [
                        {
                        "name": "to",
                        "type": "address"
                        },
                        {
                        "name": "approved",
                        "type": "bool"
                        }
                    ],
                    "name": "setApprovalForAll",
                    "outputs": [],
                    "payable": false,
                    "stateMutability": "nonpayable",
                    "type": "function"
                    },
                    {
                    "constant": false,
                    "inputs": [
                        {
                        "name": "from",
                        "type": "address"
                        },
                        {
                        "name": "to",
                        "type": "address"
                        },
                        {
                        "name": "tokenId",
                        "type": "uint256"
                        },
                        {
                        "name": "_data",
                        "type": "bytes"
                        }
                    ],
                    "name": "safeTransferFrom",
                    "outputs": [],
                    "payable": false,
                    "stateMutability": "nonpayable",
                    "type": "function"
                    },
                    {
                    "constant": true,
                    "inputs": [
                        {
                        "name": "owner",
                        "type": "address"
                        },
                        {
                        "name": "operator",
                        "type": "address"
                        }
                    ],
                    "name": "isApprovedForAll",
                    "outputs": [
                        {
                        "name": "",
                        "type": "bool"
                        }
                    ],
                    "payable": false,
                    "stateMutability": "view",
                    "type": "function"
                    },
                    {
                    "anonymous": false,
                    "inputs": [
                        {
                        "indexed": false,
                        "name": "_info",
                        "type": "uint256"
                        }
                    ],
                    "name": "inform",
                    "type": "event"
                    },
                    {
                    "anonymous": false,
                    "inputs": [
                        {
                        "indexed": false,
                        "name": "_info",
                        "type": "bytes"
                        }
                    ],
                    "name": "informBytes",
                    "type": "event"
                    },
                    {
                    "anonymous": false,
                    "inputs": [
                        {
                        "indexed": true,
                        "name": "from",
                        "type": "address"
                        },
                        {
                        "indexed": true,
                        "name": "to",
                        "type": "address"
                        },
                        {
                        "indexed": true,
                        "name": "tokenId",
                        "type": "uint256"
                        }
                    ],
                    "name": "Transfer",
                    "type": "event"
                    },
                    {
                    "anonymous": false,
                    "inputs": [
                        {
                        "indexed": true,
                        "name": "owner",
                        "type": "address"
                        },
                        {
                        "indexed": true,
                        "name": "approved",
                        "type": "address"
                        },
                        {
                        "indexed": true,
                        "name": "tokenId",
                        "type": "uint256"
                        }
                    ],
                    "name": "Approval",
                    "type": "event"
                    },
                    {
                    "anonymous": false,
                    "inputs": [
                        {
                        "indexed": true,
                        "name": "owner",
                        "type": "address"
                        },
                        {
                        "indexed": true,
                        "name": "operator",
                        "type": "address"
                        },
                        {
                        "indexed": false,
                        "name": "approved",
                        "type": "bool"
                        }
                    ],
                    "name": "ApprovalForAll",
                    "type": "event"
                    },
                    {
                    "constant": false,
                    "inputs": [
                        {
                        "name": "_name",
                        "type": "string"
                        },
                        {
                        "name": "_starStory",
                        "type": "string"
                        },
                        {
                        "name": "_ra",
                        "type": "string"
                        },
                        {
                        "name": "_dec",
                        "type": "string"
                        },
                        {
                        "name": "_mag",
                        "type": "string"
                        },
                        {
                        "name": "_tokenId",
                        "type": "uint256"
                        }
                    ],
                    "name": "createStar",
                    "outputs": [],
                    "payable": false,
                    "stateMutability": "nonpayable",
                    "type": "function"
                    },
                    {
                    "constant": false,
                    "inputs": [
                        {
                        "name": "_tokenId",
                        "type": "uint256"
                        },
                        {
                        "name": "_price",
                        "type": "uint256"
                        }
                    ],
                    "name": "putStarUpForSale",
                    "outputs": [],
                    "payable": false,
                    "stateMutability": "nonpayable",
                    "type": "function"
                    },
                    {
                    "constant": false,
                    "inputs": [
                        {
                        "name": "_tokenId",
                        "type": "uint256"
                        }
                    ],
                    "name": "buyStar",
                    "outputs": [],
                    "payable": true,
                    "stateMutability": "payable",
                    "type": "function"
                    }
                ]

            var StarNotary = web3.eth.contract(abi)
            var starNotary = StarNotary.at('0xFB88dE099e13c3ED21F80a7a1E49f8CAEcF10df6');
            // // Get and display star owner
            // starNotary.starOwner(function (error, result) {
            //     if (!error) {
            //         document.getElementById('star-owner').innerText = result
            //     } else {
            //         console.log(error);
            //     }
            // });
            // Enable claim button being clicked

            function createContract(){
                starInstance = StarNotary.new({from: accounts[0]}, function(error, result){
                if(!error)
                    console.log(JSON.stringify(result));
                else
                    console.error(error);
                })
            }

            function createContract(account) {
                console.log("test")
                StarNotary.new({from: account}, function(error, result){
                    if(!error)
                        console.log(result);
                    else
                        console.error(error);
                    }
                )
            }

            function createContractClicked() {
                web3.eth.getAccounts(function(error, accounts) {
                    if (error) {
                        return
                    }
                    var account = accounts[0]
                    createContract(account)
                })
            }

            function createStar(account){
               starNotary.createStar("name", "starStory", "newRa", "newDec", "newMag", 1, {from: account}, function(error, result){
                if(!error)
                    console.log(JSON.stringify(result));
                else
                    console.error(error);
                })
            }

            function claimButtonClicked() {
                document.getElementById('msg').innerHTML = 'Create Star';
                web3.eth.getAccounts(function(error, accounts) {
                    if (error) {
                        console.log(error)
                        return
                    }
                    var account = accounts[0]
                    document.getElementById('msg').innerHTML = account;
                    console.log(accounts)



                    createStar(account)

                    //console.log(star)
                    //star.createStar("test", "starStory", "ra", "dec", "mag", 1, {from : account})
                    // starNotary.createStar(function (error, result) {
                    //     if(error){
                    //         document.getElementById('msg').innerHTML = 'error occurred creating a star';
                    //     }
                    //     // if (!error) {
                    //     //     var starClaimedEvent = starNotary.starClaimed({from: account});
                    //     //     starClaimedEvent.watch(function(error, result) {
                    //     //         if (!error) {
                    //     //             location.reload();
                    //     //         } else {
                    //     //             console.log('watching for star claimed event is failing');
                    //     //         }
                    //     //     });
                    //     // } else {
                    //     //     console.log(error);
                    //     // }
                    // });
                })
            }
        </script>
    </body>
</html>