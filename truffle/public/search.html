<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Search Star</title>
        <link rel="stylesheet" type="text/css" href="./css/style.css">
        <script src="https://cdn.jsdelivr.net/gh/ethereum/web3.js/dist/web3.min.js"></script>
    </head>
    <body>
        <div class="container">
            <a>Claim Star</a>
            <p>
                <textarea name="address" cols="40" rows="2" maxlength="250" required="" placeholder="Enter Star Id Here..." class="textarea"></textarea>
                <br>
                <button id="claim-button" onclick="claimButtonClicked()" class="btn">Search Star</button>
                <label id="msg"></label>
            </p>
        </div>
        <script>
            if(typeof web3 != 'undefined') {
                web3 = new Web3(web3.currentProvider) // what Metamask injected
                console.log(web3.currentProvider)
            } else {
                // Instantiate and set Ganache as your provider
                web3 = new Web3(new Web3.providers.HttpProvider("http://localhost:9545"));
            }
            // The default (top) wallet account from a list of test accounts
            web3.eth.defaultAccount = web3.eth.accounts[0];

            // The interface definition for your smart contract (the ABI)

            console.log(abi)
            var StarNotary = web3.eth.contract(abi)
            var starNotary = StarNotary.at('0xB7FdE4215432B012c3F3E18716760e018e97EEf5');

            function createContractClicked() {
                web3.eth.getAccounts(function(error, accounts) {
                    if (error) {
                        return
                    }
                    var account = accounts[0]
                    createContract(account)
                })
            }

            function createStar(account){
               starNotary.createStar("name", "starStory", "newRa", "newDec", "newMag", 1, {from: account}, function(error, result){
                if(!error)
                    console.log(JSON.stringify(result));
                else
                    console.error(error);
                })
            }

            function claimButtonClicked() {
                document.getElementById('msg').innerHTML = 'Create Star';
                web3.eth.getAccounts(function(error, accounts) {
                    if (error) {
                        console.log(error)
                        return
                    }
                    var account = accounts[0]
                    document.getElementById('msg').innerHTML = account;
                    console.log(accounts)



                    createStar(account)

                    //console.log(star)
                    //star.createStar("test", "starStory", "ra", "dec", "mag", 1, {from : account})
                    // starNotary.createStar(function (error, result) {
                    //     if(error){
                    //         document.getElementById('msg').innerHTML = 'error occurred creating a star';
                    //     }
                    //     // if (!error) {
                    //     //     var starClaimedEvent = starNotary.starClaimed({from: account});
                    //     //     starClaimedEvent.watch(function(error, result) {
                    //     //         if (!error) {
                    //     //             location.reload();
                    //     //         } else {
                    //     //             console.log('watching for star claimed event is failing');
                    //     //         }
                    //     //     });
                    //     // } else {
                    //     //     console.log(error);
                    //     // }
                    // });
                })
            }
        </script>
    </body>
</html>